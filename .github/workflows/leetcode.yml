name: Update LeetCode Stats

on:
  schedule:
    - cron: "0 */12 * * *"   # runs every 12 hours
  workflow_dispatch:          # allow manual trigger

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install jq (JSON parser)
        run: sudo apt-get install jq -y

      - name: Fetch LeetCode Stats
        run: |
          curl -s https://leetcode-stats-api.herokuapp.com/sidrajagrawal > stats.json

      - name: Update README
        run: |
          totalSolved=$(jq .totalSolved stats.json)
          easySolved=$(jq .easySolved stats.json)
          mediumSolved=$(jq .mediumSolved stats.json)
          hardSolved=$(jq .hardSolved stats.json)
          ranking=$(jq .ranking stats.json)
          contestRating=$(jq .contestRating stats.json)

          # Create tree block with placeholders
          cat > tree.txt << 'EOF'
LeetCode Performance ── DSA Tree Visualization

                     [ LeetCode Profile ]
                            |
            -----------------------------------------------
            |                                               |
    [ Stats ]                                        [ Contests ]
            |                                               |
    Total Solved: REPLACE_TOTAL                      Rating: REPLACE_RATING
       ├── Easy: REPLACE_EASY                         Rank: REPLACE_RANK
       ├── Medium: REPLACE_MEDIUM                     Attended: 1
       └── Hard: REPLACE_HARD
EOF

          # Replace placeholders with real values
          sed -i "s/REPLACE_TOTAL/$totalSolved/" tree.txt
          sed -i "s/REPLACE_EASY/$easySolved/" tree.txt
          sed -i "s/REPLACE_MEDIUM/$mediumSolved/" tree.txt
          sed -i "s/REPLACE_HARD/$hardSolved/" tree.txt
          sed -i "s/REPLACE_RANK/$ranking/" tree.txt
          sed -i "s/REPLACE_RATING/$contestRating/" tree.txt

          # Replace between START and END in README.md
          sed -i '/<!-- LEETCODE:START -->/,/<!-- LEETCODE:END -->/c\<!-- LEETCODE:START -->\n```plaintext\n'"$(cat tree.txt)"'\n```\n<!-- LEETCODE:END -->' README.md

      - name: Commit & Push changes
        uses: EndBug/add-and-commit@v9
        with:
          author_name: github-actions
          author_email: github-actions@github.com
          message: "♻️ Update LeetCode stats"
